import{j as e,_ as G}from"./ui-vendor-CSnp-qzb.js";import{f as H,u as I,r as c}from"./wallet-adapter-CD085ODH.js";import{B as w,P as k}from"./solana-vendor-CCnuaBvR.js";import{u as z,C as A,a as R}from"./copy-CEUpoGZd.js";import{a as J,t as j}from"./index-DZJVvF0F.js";function U(n,s=64){const l=new Uint8Array(s).fill(0),o=new TextEncoder().encode(n);return l.set(o.slice(0,s)),Array.from(l)}function W({formData:n,onFormDataChange:s}){const{connection:l}=H(),t=I(),o=z(t,l),h=J(),[p,b]=c.useState(!1),[y,m]=c.useState([]),[f,F]=c.useState(!1),[N,P]=c.useState(!1);c.useEffect(()=>{t.publicKey&&!n.recipient&&s({...n,recipient:t.publicKey.toString()})},[t.publicKey,n,s]),c.useEffect(()=>{o&&!N&&(async()=>{if(!(!o||N))try{F(!0);const r=await o.getAllPaymentGateway();m(r),r.length>0&&!n.gateway&&s({...n,gateway:r[0].publicKey.toString()}),P(!0)}catch(r){console.error("Error fetching payment gateways:",r)}finally{F(!1)}})()},[o,N,n,s]);const i=a=>{const{name:r,value:x,type:C}=a.target,g={...n,[r]:C==="checkbox"?a.target.checked:x};s(g)},M=a=>a.length<=8?a:`${a.slice(0,4)}...${a.slice(-4)}`,q=async a=>{if(a.preventDefault(),!t.publicKey||!t.signTransaction){j.error("Please connect your wallet");return}if(!o){j.error("SDK not available");return}b(!0);try{const r={subscription:{amount:new w(n.amount),intervalSeconds:new w(n.intervalSeconds),autoRenew:n.autoRenew,maxRenewals:n.maxRenewals?parseInt(n.maxRenewals):null,padding:Array(8).fill(new w(0))}},x=(()=>{switch(n.frequency){case"daily":return{daily:{}};case"weekly":return{weekly:{}};case"monthly":return{monthly:{}};case"quarterly":return{quarterly:{}};case"semiAnnually":return{semiAnnually:{}};case"annually":return{annually:{}};default:return{daily:{}}}})(),C=U(n.memo,64);let g;n.approvalAmount&&(g=new w(n.approvalAmount));const E=await o.createPaymentPolicyWithUser(new k(n.tokenMint),new k(n.recipient),new k(n.gateway),r,x,C,null,g),{Transaction:$}=await G(async()=>{const{Transaction:S}=await import("./solana-vendor-CCnuaBvR.js").then(B=>B.i);return{Transaction:S}},[]),v=new $;E.forEach(S=>v.add(S)),v.feePayer=t.publicKey;const{blockhash:T,lastValidBlockHeight:L}=await l.getLatestBlockhash();v.recentBlockhash=T;const _=await t.signTransaction(v),K=await l.sendRawTransaction(_.serialize());await l.confirmTransaction({signature:K,blockhash:T,lastValidBlockHeight:L}),j.success("Payment policy created successfully!"),setTimeout(()=>h("/account"),1e3)}catch(r){const x=r instanceof Error?r.message:"Unknown error occurred";j.error("Failed to create payment policy: "+x),console.error("Error creating policy:",r)}finally{b(!1)}},d="w-full px-3 py-2 border border-[var(--color-primary)] rounded bg-transparent text-[var(--color-primary)] placeholder:text-gray-400 focus:outline-none transition-colors text-sm",u="text-xs font-medium text-[var(--color-primary)] uppercase mb-1";return e.jsx("div",{className:"items-center",children:e.jsx("div",{className:"max-w-3xl",children:e.jsxs("form",{onSubmit:q,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tokenMint",className:u,children:"Token Mint Address"}),e.jsx("input",{id:"tokenMint",name:"tokenMint",value:n.tokenMint,onChange:i,placeholder:"Token mint address",required:!0,className:d})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recipient",className:u,children:"Recipient Address"}),e.jsx("input",{id:"recipient",name:"recipient",value:n.recipient,onChange:i,placeholder:"Recipient address",required:!0,className:d})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gateway",className:u,children:"Gateway Address"}),f?e.jsx("div",{className:"flex items-center justify-center h-10 border border-[var(--color-primary)] rounded",children:e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-primary)] border-t-transparent rounded-full animate-spin"})}):e.jsxs("select",{id:"gateway",name:"gateway",value:n.gateway,onChange:i,required:!0,className:d,children:[e.jsx("option",{value:"",children:"Select gateway"}),y.map((a,r)=>e.jsxs("option",{value:a.publicKey.toString(),children:[M(a.publicKey.toString())," - ",a.account.gatewayFeeBps," bps"]},r))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:u,children:"Amount (base units)"}),e.jsx("input",{id:"amount",name:"amount",type:"number",value:n.amount,onChange:i,placeholder:"e.g., 10000000",required:!0,min:"1",className:d})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"intervalSeconds",className:u,children:"Interval (seconds)"}),e.jsx("input",{id:"intervalSeconds",name:"intervalSeconds",type:"number",value:n.intervalSeconds,onChange:i,placeholder:"e.g., 2592000",required:!0,min:"1",className:d})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:u,children:"Frequency"}),e.jsxs("select",{id:"frequency",name:"frequency",value:n.frequency,onChange:i,className:d,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"quarterly",children:"Quarterly"}),e.jsx("option",{value:"semiAnnually",children:"Semi-Annually"}),e.jsx("option",{value:"annually",children:"Annually"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxRenewals",className:u,children:"Max Renewals"}),e.jsx("input",{id:"maxRenewals",name:"maxRenewals",type:"number",value:n.maxRenewals,onChange:i,placeholder:"Leave empty for unlimited",min:"1",className:d})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"approvalAmount",className:u,children:"Approval Amount"}),e.jsx("input",{id:"approvalAmount",name:"approvalAmount",type:"number",value:n.approvalAmount,onChange:i,placeholder:"Token approval amount",min:"1",className:d})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memo",className:u,children:"Memo (optional)"}),e.jsx("input",{id:"memo",name:"memo",value:n.memo,onChange:i,placeholder:"Payment description",maxLength:64,className:d})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"autoRenew",name:"autoRenew",type:"checkbox",checked:n.autoRenew,onChange:i,className:"w-4 h-4 border border-[var(--color-primary)] rounded"}),e.jsx("label",{htmlFor:"autoRenew",className:"text-sm",children:"Auto-renew payments"})]}),e.jsx("button",{type:"submit",disabled:p||!t.connected,className:"w-full flex items-center justify-center gap-2 px-4 py-2 mt-6 border border-[var(--color-primary)] rounded bg-transparent text-[var(--color-primary)] hover:bg-[var(--color-primary)] hover:text-white transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{fontFamily:"var(--font-secondary)",fontSize:"14px",textTransform:"uppercase"},children:p?"Creating...":"Create Payment Policy"})]})})})}function V({formData:n}){const[s,l]=c.useState(null),[t,o]=c.useState('<button class="tributary-subscribe-btn" data-policy-id="your_policy_id">Subscribe Now</button>'),h=`<script src="https://cdn.tributary.io/v1/tributary.js"><\/script>
<script>
  Tributary.init({
    tokenMint: '${n.tokenMint}',
    recipient: '${n.recipient}',
    gateway: '${n.gateway}',
    amount: '${n.amount}',
    intervalSeconds: ${n.intervalSeconds},
    memo: '${n.memo}',
    frequency: '${n.frequency}',
    autoRenew: ${n.autoRenew},
    maxRenewals: ${n.maxRenewals||"null"},
    approvalAmount: '${n.approvalAmount}',
    network: 'mainnet'
  })
<\/script>`,[p,b]=c.useState(`.tributary-subscribe-btn {
  padding: 8px 16px;
  border: 1px solid #000970;
  border-radius: 4px;
  background: transparent;
  color: #000970;
  font-family: 'Denim', sans-serif;
  font-size: 14px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s ease;
}
.tributary-subscribe-btn:hover {
  background: #000970;
  color: white;
}`),y=(m,f)=>{navigator.clipboard.writeText(m),l(f),setTimeout(()=>l(null),2e3)};return e.jsxs("div",{className:"max-w-[700px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Edit the HTML and CSS below. The button preview updates in real-time. The JavaScript code reflects your form configuration."}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("p",{className:"text-xs uppercase font-semibold mb-2 text-gray-600",children:"Preview"}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-white border border-gray-200 rounded",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`<style>${p}</style>${t}`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"HTML"}),e.jsx("button",{onClick:()=>y(t,"html"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:s==="html"?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:t,onChange:m=>o(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"CSS"}),e.jsx("button",{onClick:()=>y(p,"css"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:s==="css"?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:p,onChange:m=>b(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:12})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"JavaScript"}),e.jsx("button",{onClick:()=>y(h,"js"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:s==="js"?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("pre",{className:"p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b overflow-x-auto text-xs",children:h})]})]})}function D(){const[n,s]=c.useState({tokenMint:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",recipient:"",gateway:"",amount:"",intervalSeconds:"2592000",memo:"",frequency:"monthly",autoRenew:!0,maxRenewals:"",approvalAmount:""}),l=t=>{s(t)};return e.jsx("div",{style:{width:"100%",backgroundColor:"#fff",fontFamily:"var(--font-primary)",flex:1},children:e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{fontFamily:"var(--font-secondary)"},children:"Payment Policy Setup"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create a new recurring payment policy and get integration code."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(W,{formData:n,onFormDataChange:l})}),e.jsx("div",{className:"relative",children:e.jsx(V,{formData:n})})]})]})})}export{D as default};

import{j as e,s as A,l as x,i as N,_ as U}from"./ui-vendor-CRek-TH2.js";import{r as i,g as X,u as Z}from"./wallet-adapter-BdusPX8w.js";import{c as Q,a as Y}from"./utils-CyLuIvzy.js";import{P as S,B as E}from"./solana-vendor-Dw0U37Pl.js";import{u as D,C as _,a as q}from"./copy-DZkuWqx-.js";import{a as ee,b as F,t as C,c as te,g as ne,d as re}from"./index-B-edn4CX.js";import{d as L,g as se,c as ae}from"./utils-C_YcIsRq.js";import"./createLucideIcon-QEjNn_cq.js";function V(t,n){if(typeof t=="function")return t(n);t!=null&&(t.current=n)}function ie(...t){return n=>{let a=!1;const s=t.map(r=>{const l=V(r,n);return!a&&typeof l=="function"&&(a=!0),l});if(a)return()=>{for(let r=0;r<s.length;r++){const l=s[r];typeof l=="function"?l():V(t[r],null)}}}}function oe(t){const n=ce(t),a=i.forwardRef((s,r)=>{const{children:l,...u}=s,d=i.Children.toArray(l),y=d.find(ue);if(y){const p=y.props.children,m=d.map(h=>h===y?i.Children.count(p)>1?i.Children.only(null):i.isValidElement(p)?p.props.children:null:h);return e.jsx(n,{...u,ref:r,children:i.isValidElement(p)?i.cloneElement(p,void 0,m):null})}return e.jsx(n,{...u,ref:r,children:l})});return a.displayName=`${t}.Slot`,a}var le=oe("Slot");function ce(t){const n=i.forwardRef((a,s)=>{const{children:r,...l}=a;if(i.isValidElement(r)){const u=ye(r),d=pe(l,r.props);return r.type!==i.Fragment&&(d.ref=s?ie(s,u):u),i.cloneElement(r,d)}return i.Children.count(r)>1?i.Children.only(null):null});return n.displayName=`${t}.SlotClone`,n}var de=Symbol("radix.slottable");function ue(t){return i.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===de}function pe(t,n){const a={...n};for(const s in n){const r=t[s],l=n[s];/^on[A-Z]/.test(s)?r&&l?a[s]=(...d)=>{const y=l(...d);return r(...d),y}:r&&(a[s]=r):s==="style"?a[s]={...r,...l}:s==="className"&&(a[s]=[r,l].filter(Boolean).join(" "))}return{...t,...a}}function ye(t){let n=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning;return a?t.ref:(n=Object.getOwnPropertyDescriptor(t,"ref")?.get,a=n&&"isReactWarning"in n&&n.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}const me=Y("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function xe({className:t,variant:n,size:a,asChild:s=!1,...r}){const l=s?le:"button";return e.jsx(l,{"data-slot":"button",className:Q(me({variant:n,size:a,className:t})),...r})}function he({formData:t,onFormDataChange:n}){const{connection:a}=X(),s=Z(),r=D(s,a),l=ee(),[u,d]=i.useState(!1),[y,p]=i.useState([]),[m,h]=i.useState(!1),[k,B]=i.useState(!1),P=F(te),R=F(ne),[f,K]=i.useState(!0);i.useEffect(()=>{r&&!k&&((async()=>{if(!(!r||k))try{h(!0);const c=await r.getAllPaymentGateway();p(c),c.length>0&&!t.gateway&&n({...t,gateway:c[0].publicKey.toString()}),B(!0)}catch(c){console.error("Error fetching payment gateways:",c)}finally{h(!1)}})(),n({...t,tokenMint:P[0]?.address}))},[r,k,t,n,P]),i.useEffect(()=>{K(I(t.recipient))},[t.recipient]),i.useEffect(()=>{s.publicKey&&!t.recipient&&n({...t,recipient:s.publicKey.toString()})},[s.publicKey,t,n]);const v=o=>{const{name:c,value:b,type:j}=o.target,T={...t,[c]:j==="checkbox"?o.target.checked:b};n(T),c==="recipient"&&K(I(b))},I=o=>{if(!o)return!0;try{return new S(o),!0}catch{return!1}},z=async o=>{if(o.preventDefault(),!s.publicKey||!s.signTransaction){C.error("Please connect your wallet");return}if(!r){C.error("SDK not available");return}d(!0);try{const c=se(t.frequency,Number(t.intervalSeconds)),b=ae(t.memo,64);let j=new E(1e10);t.approvalAmount&&(j=new E(t.approvalAmount));const T=await r.createSubscriptionInstruction(new S(t.tokenMint),new S(t.recipient),new S(t.gateway),new E(t.amount),!1,null,c,b,null,j),{Transaction:H}=await U(async()=>{const{Transaction:M}=await import("./solana-vendor-Dw0U37Pl.js").then(J=>J.i);return{Transaction:M}},[]),w=new H;T.forEach(M=>w.add(M)),w.feePayer=s.publicKey;const{blockhash:$,lastValidBlockHeight:G}=await a.getLatestBlockhash();w.recentBlockhash=$;const W=await s.signTransaction(w),O=await a.sendRawTransaction(W.serialize());await a.confirmTransaction({signature:O,blockhash:$,lastValidBlockHeight:G}),C.success("Payment policy created successfully!"),setTimeout(()=>l("/account"),3e3)}catch(c){const b=c instanceof Error?c.message:"Unknown error occurred";C.error("Failed to create payment policy: "+b),console.error("Error creating policy:",c)}finally{d(!1)}},g="text-xs font-medium text-[var(--color-primary)] uppercase mb-1";return e.jsxs("div",{className:"max-w-[700px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Create a new recurring payment policy and get integration code."}),e.jsx("div",{className:"items-center",children:e.jsx("div",{className:"max-w-3xl",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tokenMint",className:g,children:"Token"}),e.jsx(A,{id:"tokenMint",placeholder:"Select token",selectedKeys:t.tokenMint?[t.tokenMint]:[],onSelectionChange:o=>{const c=Array.from(o)[0];n({...t,tokenMint:c})},required:!0,className:"w-full",children:P.map(o=>e.jsx(x,{description:o.name??"No token name",children:o.symbol},o.address))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recipient",className:g,children:"Recipient Address"}),e.jsx(N,{id:"recipient",name:"recipient",value:t.recipient,onChange:v,placeholder:"Recipient address",required:!0,className:`w-full ${f?"":"border-red-500"}`,isInvalid:!f,errorMessage:f?void 0:"Invalid Solana address"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gateway",className:g,children:"Processor"}),m?e.jsx("div",{className:"flex items-center justify-center h-10 border border-[var(--color-primary)] rounded",children:e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-primary)] border-t-transparent rounded-full animate-spin"})}):e.jsx(A,{id:"gateway",name:"gateway",selectedKeys:t.gateway?[t.gateway]:[],onSelectionChange:o=>{const c=Array.from(o)[0];n({...t,gateway:c})},placeholder:"Select gateway",required:!0,className:"w-full",children:y.map(o=>e.jsx(x,{description:`${L(o.account.url)}`,children:L(o.account.name)},o.publicKey.toString()))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:g,children:"Amount"}),e.jsx(N,{id:"amount",name:"amount",type:"number",value:t.amount,onChange:v,placeholder:"e.g., 10",required:!0,min:"1",className:"w-full",endContent:t.tokenMint&&R(t.tokenMint)&&e.jsx("div",{className:"pointer-events-none flex items-center",children:e.jsx("span",{className:"text-default-400 text-small",children:R(t.tokenMint)})})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:g,children:"Frequency"}),e.jsxs(A,{id:"frequency",name:"frequency",selectedKeys:t.frequency?[t.frequency]:[],onSelectionChange:o=>{const c=Array.from(o)[0];n({...t,frequency:c})},placeholder:"Select frequency",className:"w-full",children:[e.jsx(x,{children:"Daily"},"daily"),e.jsx(x,{children:"Weekly"},"weekly"),e.jsx(x,{children:"Monthly"},"monthly"),e.jsx(x,{children:"Quarterly"},"quarterly"),e.jsx(x,{children:"Semi-Annually"},"semiAnnually"),e.jsx(x,{children:"Annually"},"annually"),e.jsx(x,{children:"Custom"},"custom")]})]}),e.jsxs("div",{className:t.frequency!="custom"?"opacity-50":"",children:[e.jsx("label",{htmlFor:"intervalSeconds",className:g,children:"Custom (seconds)"}),e.jsx(N,{id:"intervalSeconds",name:"intervalSeconds",type:"number",value:t.intervalSeconds,onChange:v,placeholder:"e.g., 2592000",required:!0,min:"1",className:"w-full",disabled:t.frequency!="custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memo",className:g,children:"Memo (optional)"}),e.jsx(N,{id:"memo",name:"memo",value:t.memo,onChange:v,placeholder:"Payment description",maxLength:64,className:"w-full"})]}),e.jsx(xe,{type:"submit",disabled:u||!s.connected||!f,className:"w-full mt-6 text-sm uppercase",style:{fontFamily:"var(--font-secondary)"},children:u?"Creating...":"Create Payment Policy"})]})})})]})}function ge({formData:t}){const[n,a]=i.useState(null),s=F(re),[r,l]=i.useState('<button class="tributary-subscribe-btn" data-policy-id="your_policy_id">Subscribe Now</button>'),u=`<script src="https://cdn.tributary.io/v1/tributary.js"><\/script>
<script>
  Tributary.init({
    tokenMint: '${t.tokenMint}',
    recipient: '${t.recipient}',
    gateway: '${t.gateway}',
    amount: new BN('${parseFloat(t.amount)*Math.pow(10,s(t.tokenMint))}'),
    ${t.frequency=="custom"?`intervalSeconds: ${t.intervalSeconds},
    `:""}memo: '${t.memo}',
    frequency: '${t.frequency}'
  })
<\/script>`,[d,y]=i.useState(`.tributary-subscribe-btn {
  padding: 8px 16px;
  border: 1px solid #000970;
  border-radius: 4px;
  background: transparent;
  color: #000970;
  font-family: 'Denim', sans-serif;
  font-size: 14px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s ease;
}
.tributary-subscribe-btn:hover {
  background: #000970;
  color: white;
}`),p=(m,h)=>{navigator.clipboard.writeText(m),a(h),setTimeout(()=>a(null),2e3)};return e.jsxs("div",{className:"max-w-[500px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Edit the HTML and CSS below. The button preview updates in real-time. The JavaScript code reflects your form configuration."}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("p",{className:"text-xs uppercase font-semibold mb-2 text-gray-600",children:"Preview"}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-white border border-gray-200 rounded",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`<style>${d}</style>${r}`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"HTML"}),e.jsx("button",{onClick:()=>p(r,"html"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="html"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:r,onChange:m=>l(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"CSS"}),e.jsx("button",{onClick:()=>p(d,"css"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="css"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:d,onChange:m=>y(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:12})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"JavaScript"}),e.jsx("button",{onClick:()=>p(u,"js"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="js"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("pre",{className:"p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b overflow-x-auto text-xs",children:u})]})]})}function ke(){const[t,n]=i.useState({tokenMint:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",recipient:"",gateway:"",amount:"",intervalSeconds:"2592000",memo:"",frequency:"monthly",autoRenew:!0,approvalAmount:""}),a=s=>{n(s)};return e.jsx("div",{style:{width:"100%",backgroundColor:"#fff",fontFamily:"var(--font-primary)",flex:1},children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{fontFamily:"var(--font-secondary)"},children:"Payment Policy Setup"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-w-6xl mx-auto",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(he,{formData:t,onFormDataChange:a})}),e.jsx("div",{className:"relative w-full md:w-1/2",children:e.jsx(ge,{formData:t})})]})]})})}export{ke as default};

import{j as e,s as P,l as c,i as j,b as I,a as w}from"./ui-vendor-1RYJChHy.js";import{g as H,u as z,r as l}from"./wallet-adapter-UNg1fMY3.js";import{P as v,B as A}from"./solana-vendor-Dw0U37Pl.js";import{u as J,c as V,C as T,a as F}from"./copy-BaBviTf4.js";import{a as U,b as f,c as W,g as X,d as _}from"./index-gx6PQDqu.js";import{d as L,g as Q,c as Y}from"./utils-7PxwiIEw.js";import"./createLucideIcon-pdGHAqRv.js";function Z({formData:s,onFormDataChange:n}){const{connection:o}=H(),a=z(),i=J(a,o),N=U(),[m,y]=l.useState(!1),[S,p]=l.useState([]),[d,h]=l.useState(!1),[C,R]=l.useState(!1),k=f(W),K=f(X),G=f(_),[b,E]=l.useState(!0);l.useEffect(()=>{i&&!C&&((async()=>{if(!(!i||C))try{h(!0);const r=await i.getAllPaymentGateway();p(r),r.length>0&&!s.gateway&&n({...s,gateway:r[0].publicKey.toString()}),R(!0)}catch(r){console.error("Error fetching payment gateways:",r)}finally{h(!1)}})(),n({...s,tokenMint:k[0]?.address}))},[i,C,s,n,k]),l.useEffect(()=>{E($(s.recipient))},[s.recipient]),l.useEffect(()=>{a.publicKey&&!s.recipient&&n({...s,recipient:a.publicKey.toString()})},[a.publicKey,s,n]);const g=t=>{const{name:r,value:x,type:M}=t.target,q={...s,[r]:M==="checkbox"?t.target.checked:x};n(q),r==="recipient"&&E($(x))},$=t=>{if(!t)return!0;try{return new v(t),!0}catch{return!1}},B=async()=>{if(!a.publicKey||!a.signTransaction){w({title:"Error",description:"Please connect your wallet",color:"danger"});return}if(!i){w({title:"Error",description:"SDK not available",color:"danger"});return}y(!0);try{const t=Q(s.frequency,Number(s.intervalSeconds)),r=Y(s.memo,64);let x=new A(1e10);s.approvalAmount&&(x=new A(s.approvalAmount));const M=parseFloat(s.amount)*Math.pow(10,G(s.tokenMint)),q=await i.createSubscriptionInstruction(new v(s.tokenMint),new v(s.recipient),new v(s.gateway),new A(M),!1,null,t,r,null,x);await V(q,a,o),w({title:"Success",description:"Payment policy created successfully!",color:"success"}),setTimeout(()=>N("/account"),3e3)}catch(t){const r=t instanceof Error?t.message:"Unknown error occurred";w({title:"Error",description:"Failed to create payment policy: "+r,color:"danger"}),console.error("Error creating policy:",t)}finally{y(!1)}},u="text-xs font-medium text-[var(--color-primary)] uppercase mb-1";return e.jsxs("div",{className:"max-w-[700px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Create a new recurring payment policy and get integration code."}),e.jsx("div",{className:"items-center",children:e.jsxs("div",{className:"max-w-3xl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tokenMint",className:u,children:"Token"}),e.jsx(P,{id:"tokenMint",placeholder:"Select token",selectedKeys:s.tokenMint?[s.tokenMint]:[],onSelectionChange:t=>{const r=Array.from(t)[0];n({...s,tokenMint:r})},required:!0,className:"w-full",children:k.map(t=>e.jsx(c,{description:t.name??"No token name",children:t.symbol},t.address))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recipient",className:u,children:"Recipient Address"}),e.jsx(j,{id:"recipient",name:"recipient",value:s.recipient,onChange:g,placeholder:"Recipient address",required:!0,className:`w-full ${b?"":"border-red-500"}`,isInvalid:!b,errorMessage:b?void 0:"Invalid Solana address"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gateway",className:u,children:"Processor"}),d?e.jsx("div",{className:"flex items-center justify-center h-10 border border-[var(--color-primary)] rounded",children:e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-primary)] border-t-transparent rounded-full animate-spin"})}):e.jsx(P,{id:"gateway",name:"gateway",selectedKeys:s.gateway?[s.gateway]:[],onSelectionChange:t=>{const r=Array.from(t)[0];n({...s,gateway:r})},placeholder:"Select gateway",required:!0,className:"w-full",children:S.map(t=>e.jsx(c,{description:`${L(t.account.url)}`,children:L(t.account.name)},t.publicKey.toString()))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:u,children:"Amount"}),e.jsx(j,{id:"amount",name:"amount",type:"number",value:s.amount,onChange:g,placeholder:"e.g., 10",required:!0,min:"0.00001",className:"w-full",endContent:s.tokenMint&&K(s.tokenMint)&&e.jsx("div",{className:"pointer-events-none flex items-center",children:e.jsx("span",{className:"text-default-400 text-small",children:K(s.tokenMint)})})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:u,children:"Frequency"}),e.jsxs(P,{id:"frequency",name:"frequency",selectedKeys:s.frequency?[s.frequency]:[],onSelectionChange:t=>{const r=Array.from(t)[0];n({...s,frequency:r})},placeholder:"Select frequency",className:"w-full",children:[e.jsx(c,{children:"Daily"},"daily"),e.jsx(c,{children:"Weekly"},"weekly"),e.jsx(c,{children:"Monthly"},"monthly"),e.jsx(c,{children:"Quarterly"},"quarterly"),e.jsx(c,{children:"Semi-Annually"},"semiAnnually"),e.jsx(c,{children:"Annually"},"annually"),e.jsx(c,{children:"Custom"},"custom")]})]}),e.jsxs("div",{className:s.frequency!="custom"?"opacity-50":"",children:[e.jsx("label",{htmlFor:"intervalSeconds",className:u,children:"Custom (seconds)"}),e.jsx(j,{id:"intervalSeconds",name:"intervalSeconds",type:"number",value:s.intervalSeconds,onChange:g,placeholder:"e.g., 2592000",required:!0,min:"1",className:"w-full",disabled:s.frequency!="custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memo",className:u,children:"Memo (optional)"}),e.jsx(j,{id:"memo",name:"memo",value:s.memo,onChange:g,placeholder:"Payment description",maxLength:64,className:"w-full"})]}),e.jsx(I,{isDisabled:m||!a.connected||!b||!s.amount,className:"w-full mt-6 text-sm uppercase text-white",color:"primary",isLoading:m,onClick:B,children:m?"Creating...":"Create Payment Policy"})]})})]})}function O({formData:s}){const[n,o]=l.useState(null),a=f(_),[i,N]=l.useState('<button class="tributary-subscribe-btn" data-policy-id="your_policy_id">Subscribe Now</button>'),m=`<script src="https://cdn.tributary.io/v1/tributary.js"><\/script>
<script>
  Tributary.init({
    tokenMint: '${s.tokenMint}',
    recipient: '${s.recipient}',
    gateway: '${s.gateway}',
    amount: new BN('${parseFloat(s.amount)*Math.pow(10,a(s.tokenMint))}'),
    ${s.frequency=="custom"?`intervalSeconds: ${s.intervalSeconds},
    `:""}memo: '${s.memo}',
    frequency: '${s.frequency}'
  })
<\/script>`,[y,S]=l.useState(`.tributary-subscribe-btn {
  padding: 8px 16px;
  border: 1px solid #000970;
  border-radius: 4px;
  background: transparent;
  color: #000970;
  font-family: 'Denim', sans-serif;
  font-size: 14px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s ease;
}
.tributary-subscribe-btn:hover {
  background: #000970;
  color: white;
}`),p=(d,h)=>{navigator.clipboard.writeText(d),o(h),setTimeout(()=>o(null),2e3)};return e.jsxs("div",{className:"max-w-[500px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Edit the HTML and CSS below. The button preview updates in real-time. The JavaScript code reflects your form configuration."}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("p",{className:"text-xs uppercase font-semibold mb-2 text-gray-600",children:"Preview"}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-white border border-gray-200 rounded",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`<style>${y}</style>${i}`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"HTML"}),e.jsx("button",{onClick:()=>p(i,"html"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="html"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:i,onChange:d=>N(d.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"CSS"}),e.jsx("button",{onClick:()=>p(y,"css"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="css"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:y,onChange:d=>S(d.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:12})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"JavaScript"}),e.jsx("button",{onClick:()=>p(m,"js"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:n==="js"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("pre",{className:"p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b overflow-x-auto text-xs",children:m})]})]})}function le(){const[s,n]=l.useState({tokenMint:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",recipient:"",gateway:"",amount:"",intervalSeconds:"2592000",memo:"",frequency:"monthly",autoRenew:!0,approvalAmount:""}),o=a=>{n(a)};return e.jsx("div",{style:{width:"100%",backgroundColor:"#fff",fontFamily:"var(--font-primary)",flex:1},children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{fontFamily:"var(--font-secondary)"},children:"Payment Policy Setup"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-w-6xl mx-auto",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(Z,{formData:s,onFormDataChange:o})}),e.jsx("div",{className:"relative w-full md:w-1/2",children:e.jsx(O,{formData:s})})]})]})})}export{le as default};

import{j as e,s as T,l as x,i as N,_ as J}from"./ui-vendor-CRek-TH2.js";import{r as o,g as U,u as X}from"./wallet-adapter-BdusPX8w.js";import{c as Z,a as Q}from"./utils-CyLuIvzy.js";import{P as S,B as C}from"./solana-vendor-Dw0U37Pl.js";import{u as Y,C as _,a as q}from"./copy-CU11Dk8W.js";import{a as D,b as $,t as k,c as ee,g as te}from"./index-WMq_aZnN.js";import"./createLucideIcon-QEjNn_cq.js";function K(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function re(...t){return r=>{let a=!1;const s=t.map(n=>{const l=K(n,r);return!a&&typeof l=="function"&&(a=!0),l});if(a)return()=>{for(let n=0;n<s.length;n++){const l=s[n];typeof l=="function"?l():K(t[n],null)}}}}function ne(t){const r=ae(t),a=o.forwardRef((s,n)=>{const{children:l,...u}=s,d=o.Children.toArray(l),y=d.find(oe);if(y){const p=y.props.children,m=d.map(h=>h===y?o.Children.count(p)>1?o.Children.only(null):o.isValidElement(p)?p.props.children:null:h);return e.jsx(r,{...u,ref:n,children:o.isValidElement(p)?o.cloneElement(p,void 0,m):null})}return e.jsx(r,{...u,ref:n,children:l})});return a.displayName=`${t}.Slot`,a}var se=ne("Slot");function ae(t){const r=o.forwardRef((a,s)=>{const{children:n,...l}=a;if(o.isValidElement(n)){const u=ce(n),d=le(l,n.props);return n.type!==o.Fragment&&(d.ref=s?re(s,u):u),o.cloneElement(n,d)}return o.Children.count(n)>1?o.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var ie=Symbol("radix.slottable");function oe(t){return o.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===ie}function le(t,r){const a={...r};for(const s in r){const n=t[s],l=r[s];/^on[A-Z]/.test(s)?n&&l?a[s]=(...d)=>{const y=l(...d);return n(...d),y}:n&&(a[s]=n):s==="style"?a[s]={...n,...l}:s==="className"&&(a[s]=[n,l].filter(Boolean).join(" "))}return{...t,...a}}function ce(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning;return a?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,a=r&&"isReactWarning"in r&&r.isReactWarning,a?t.props.ref:t.props.ref||t.ref)}const de=Q("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function ue({className:t,variant:r,size:a,asChild:s=!1,...n}){const l=s?se:"button";return e.jsx(l,{"data-slot":"button",className:Z(de({variant:r,size:a,className:t})),...n})}function pe(t,r=64){const a=new Uint8Array(r).fill(0),n=new TextEncoder().encode(t);return a.set(n.slice(0,r)),Array.from(a)}function ye({formData:t,onFormDataChange:r}){const{connection:a}=U(),s=X(),n=Y(s,a),l=D(),[u,d]=o.useState(!1),[y,p]=o.useState([]),[m,h]=o.useState(!1),[A,I]=o.useState(!1),B=$(ee),[f,F]=o.useState(!0);o.useEffect(()=>{s.publicKey&&!t.recipient&&r({...t,recipient:s.publicKey.toString()})},[s.publicKey,t,r]),o.useEffect(()=>{F(M(t.recipient))},[t.recipient]),o.useEffect(()=>{n&&!A&&(async()=>{if(!(!n||A))try{h(!0);const c=await n.getAllPaymentGateway();p(c),c.length>0&&!t.gateway&&r({...t,gateway:c[0].publicKey.toString()}),I(!0)}catch(c){console.error("Error fetching payment gateways:",c)}finally{h(!1)}})()},[n,A,t,r]);const v=i=>{const{name:c,value:b,type:w}=i.target,P={...t,[c]:w==="checkbox"?i.target.checked:b};r(P),c==="recipient"&&F(M(b))},L=i=>i.length<=8?i:`${i.slice(0,4)}...${i.slice(-4)}`,M=i=>{if(!i)return!0;try{return new S(i),!0}catch{return!1}},V=async i=>{if(i.preventDefault(),!s.publicKey||!s.signTransaction){k.error("Please connect your wallet");return}if(!n){k.error("SDK not available");return}d(!0);try{const c=(()=>{switch(t.frequency){case"daily":return{daily:{}};case"weekly":return{weekly:{}};case"monthly":return{monthly:{}};case"quarterly":return{quarterly:{}};case"semiAnnually":return{semiAnnually:{}};case"annually":return{annually:{}};case"custom":return{custom:{0:new C(t.intervalSeconds)}};default:return{daily:{}}}})(),b=pe(t.memo,64);let w=new C(1e10);t.approvalAmount&&(w=new C(t.approvalAmount));const P=await n.createSubscriptionInstruction(new S(t.tokenMint),new S(t.recipient),new S(t.gateway),new C(t.amount),!1,null,c,b,null,w),{Transaction:z}=await J(async()=>{const{Transaction:E}=await import("./solana-vendor-Dw0U37Pl.js").then(O=>O.i);return{Transaction:E}},[]),j=new z;P.forEach(E=>j.add(E)),j.feePayer=s.publicKey;const{blockhash:R,lastValidBlockHeight:G}=await a.getLatestBlockhash();j.recentBlockhash=R;const H=await s.signTransaction(j),W=await a.sendRawTransaction(H.serialize());await a.confirmTransaction({signature:W,blockhash:R,lastValidBlockHeight:G}),k.success("Payment policy created successfully!"),setTimeout(()=>l("/account"),1e3)}catch(c){const b=c instanceof Error?c.message:"Unknown error occurred";k.error("Failed to create payment policy: "+b),console.error("Error creating policy:",c)}finally{d(!1)}},g="text-xs font-medium text-[var(--color-primary)] uppercase mb-1";return e.jsxs("div",{className:"max-w-[700px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Create a new recurring payment policy and get integration code."}),e.jsx("div",{className:"items-center",children:e.jsx("div",{className:"max-w-3xl",children:e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tokenMint",className:g,children:"Token"}),e.jsx(T,{id:"tokenMint",placeholder:"Select token",selectedKeys:t.tokenMint?[t.tokenMint]:[],onSelectionChange:i=>{const c=Array.from(i)[0];r({...t,tokenMint:c})},required:!0,className:"w-full",children:B.map(i=>e.jsx(x,{description:i.name??"No token name",children:i.symbol},i.address))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"recipient",className:g,children:"Recipient Address"}),e.jsx(N,{id:"recipient",name:"recipient",value:t.recipient,onChange:v,placeholder:"Recipient address",required:!0,className:`w-full ${f?"":"border-red-500"}`,isInvalid:!f,errorMessage:f?void 0:"Invalid Solana address"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gateway",className:g,children:"Gateway Address"}),m?e.jsx("div",{className:"flex items-center justify-center h-10 border border-[var(--color-primary)] rounded",children:e.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-primary)] border-t-transparent rounded-full animate-spin"})}):e.jsx(T,{id:"gateway",name:"gateway",selectedKeys:t.gateway?[t.gateway]:[],onSelectionChange:i=>{const c=Array.from(i)[0];r({...t,gateway:c})},placeholder:"Select gateway",required:!0,className:"w-full",children:y.map(i=>e.jsx(x,{description:`${i.account.gatewayFeeBps} bps`,children:L(i.publicKey.toString())},i.publicKey.toString()))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:g,children:"Amount (base units)"}),e.jsx(N,{id:"amount",name:"amount",type:"number",value:t.amount,onChange:v,placeholder:"e.g., 10000000",required:!0,min:"1",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"frequency",className:g,children:"Frequency"}),e.jsxs(T,{id:"frequency",name:"frequency",selectedKeys:t.frequency?[t.frequency]:[],onSelectionChange:i=>{const c=Array.from(i)[0];r({...t,frequency:c})},placeholder:"Select frequency",className:"w-full",children:[e.jsx(x,{children:"Daily"},"daily"),e.jsx(x,{children:"Weekly"},"weekly"),e.jsx(x,{children:"Monthly"},"monthly"),e.jsx(x,{children:"Quarterly"},"quarterly"),e.jsx(x,{children:"Semi-Annually"},"semiAnnually"),e.jsx(x,{children:"Annually"},"annually"),e.jsx(x,{children:"Custom"},"custom")]})]}),e.jsxs("div",{className:t.frequency!="custom"?"opacity-50":"",children:[e.jsx("label",{htmlFor:"intervalSeconds",className:g,children:"Custom (seconds)"}),e.jsx(N,{id:"intervalSeconds",name:"intervalSeconds",type:"number",value:t.intervalSeconds,onChange:v,placeholder:"e.g., 2592000",required:!0,min:"1",className:"w-full",disabled:t.frequency!="custom"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"memo",className:g,children:"Memo (optional)"}),e.jsx(N,{id:"memo",name:"memo",value:t.memo,onChange:v,placeholder:"Payment description",maxLength:64,className:"w-full"})]}),e.jsx(ue,{type:"submit",disabled:u||!s.connected||!f,className:"w-full mt-6 text-sm uppercase",style:{fontFamily:"var(--font-secondary)"},children:u?"Creating...":"Create Payment Policy"})]})})})]})}function me({formData:t}){const[r,a]=o.useState(null),s=$(te),[n,l]=o.useState('<button class="tributary-subscribe-btn" data-policy-id="your_policy_id">Subscribe Now</button>'),u=`<script src="https://cdn.tributary.io/v1/tributary.js"><\/script>
<script>
  Tributary.init({
    tokenMint: '${t.tokenMint}',
    recipient: '${t.recipient}',
    gateway: '${t.gateway}',
    amount: new BN('${parseFloat(t.amount)*Math.pow(10,s(t.tokenMint))}'),
    ${t.frequency=="custom"?`intervalSeconds: ${t.intervalSeconds},
    `:""}memo: '${t.memo}',
    frequency: '${t.frequency}'
  })
<\/script>`,[d,y]=o.useState(`.tributary-subscribe-btn {
  padding: 8px 16px;
  border: 1px solid #000970;
  border-radius: 4px;
  background: transparent;
  color: #000970;
  font-family: 'Denim', sans-serif;
  font-size: 14px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.2s ease;
}
.tributary-subscribe-btn:hover {
  background: #000970;
  color: white;
}`),p=(m,h)=>{navigator.clipboard.writeText(m),a(h),setTimeout(()=>a(null),2e3)};return e.jsxs("div",{className:"max-w-[500px] space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Edit the HTML and CSS below. The button preview updates in real-time. The JavaScript code reflects your form configuration."}),e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded",children:[e.jsx("p",{className:"text-xs uppercase font-semibold mb-2 text-gray-600",children:"Preview"}),e.jsx("div",{className:"flex items-center justify-center p-4 bg-white border border-gray-200 rounded",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:`<style>${d}</style>${n}`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"HTML"}),e.jsx("button",{onClick:()=>p(n,"html"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:r==="html"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:n,onChange:m=>l(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"CSS"}),e.jsx("button",{onClick:()=>p(d,"css"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:r==="css"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("textarea",{value:d,onChange:m=>y(m.target.value),className:"w-full p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b text-xs resize-none focus:outline-none",rows:12})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center px-3 py-2 bg-gray-50 border border-gray-200 rounded-t",children:[e.jsx("span",{className:"text-xs font-semibold uppercase text-gray-600",children:"JavaScript"}),e.jsx("button",{onClick:()=>p(u,"js"),className:"flex items-center gap-1 px-2 py-1 text-xs border rounded hover:bg-gray-200 transition-colors",style:{borderColor:"var(--color-primary)"},children:r==="js"?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-3 h-3"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-3 h-3"}),"Copy"]})})]}),e.jsx("pre",{className:"p-3 bg-gray-50 border border-t-0 border-gray-200 rounded-b overflow-x-auto text-xs",children:u})]})]})}function je(){const[t,r]=o.useState({tokenMint:"4zMMC9srt5Ri5X14GAgXhaHii3GnPAEERYPJgZJDncDU",recipient:"",gateway:"",amount:"",intervalSeconds:"2592000",memo:"",frequency:"monthly",autoRenew:!0,approvalAmount:""}),a=s=>{r(s)};return e.jsx("div",{style:{width:"100%",backgroundColor:"#fff",fontFamily:"var(--font-primary)",flex:1},children:e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h2",{className:"text-2xl font-bold mb-2",style:{fontFamily:"var(--font-secondary)"},children:"Payment Policy Setup"})}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsx("div",{children:e.jsx(ye,{formData:t,onFormDataChange:a})}),e.jsx("div",{className:"relative",children:e.jsx(me,{formData:t})})]})]})})}export{je as default};
